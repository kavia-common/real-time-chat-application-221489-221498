{"is_source_file": true, "format": "TypeScript", "description": "This file defines a WebSocket transport module with fallback to a mock transport for a chat application. It provides functions to create a resilient WebSocket connection that handles reconnection strategies and falls back to a mock transport when the environment variable for WebSocket URL is missing or when connection attempts fail.", "external_files": ["@/types"], "external_methods": [], "published": ["createWebSocket"], "classes": [{"name": "MockTransport", "description": "A mock implementation of the Transport interface that echoes messages and simulates connection status changes for development or fallback purposes."}], "methods": [{"name": "export function createWebSocket(url?: string): Transport { createWebSocket", "description": "Creates a resilient WebSocket transport with exponential backoff, falling back to a mock transport if no URL is provided or on failure.", "scope": "", "scopeKind": ""}, {"name": "close() { close", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "constructor() { constructor", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "private emitMessage(m: Message) { emitMessage", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "private emitStatus(s: ConnectionStatus) { emitStatus", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "onMessage(cb: Listener<Message>) { onMessage", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "onStatus(cb: Listener<ConnectionStatus>) { onStatus", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "send(msg: Message) { send", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}], "calls": ["setTimeout", "JSON.parse", "JSON.stringify", "Math.min", "Date.now", "process.env.NEXT_PUBLIC_WS_URL"], "search-terms": ["WebSocket", "Resilient connection", "Fallback mock transport", "createWebSocket", "exponential backoff", "in-memory mock"], "state": 2, "file_id": 14, "knowledge_revision": 41, "git_revision": "", "revision_history": [{"29": ""}, {"41": ""}], "ctags": [{"_type": "tag", "name": "Listener", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^type Listener<T> = (data: T) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "MAX_BACKOFF", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const MAX_BACKOFF = 16000; \\/\\/ 16s$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "MockTransport", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^class MockTransport implements Transport {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "Transport", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^interface Transport {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "close", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  close() {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "close", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  close: () => void;$/", "language": "TypeScript", "kind": "property", "scope": "Transport", "scopeKind": "interface"}, {"_type": "tag", "name": "closed", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private closed = false;$/", "language": "TypeScript", "kind": "property", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const connect = () => {$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  constructor() {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "createWebSocket", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^export function createWebSocket(url?: string): Transport {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "emitMessage", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const emitMessage = (m: Message) => {$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "emitMessage", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private emitMessage(m: Message) {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "emitStatus", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const emitStatus = (s: ConnectionStatus) => {$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "emitStatus", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private emitStatus(s: ConnectionStatus) {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "endpoint", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const endpoint = url || envUrl;$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "envUrl", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const envUrl = process.env.NEXT_PUBLIC_WS_URL;$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "mock", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^          const mock = new MockTransport();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "msgListeners", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const msgListeners: Listener<Message>[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "msgListeners", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private msgListeners: Listener<Message>[] = [];$/", "language": "TypeScript", "kind": "property", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "onMessage", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  onMessage(cb: Listener<Message>) {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "onMessage", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  onMessage: (cb: Listener<Message>) => void;$/", "language": "TypeScript", "kind": "property", "scope": "Transport", "scopeKind": "interface"}, {"_type": "tag", "name": "onStatus", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  onStatus(cb: Listener<ConnectionStatus>) {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "onStatus", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  onStatus: (cb: Listener<ConnectionStatus>) => void;$/", "language": "TypeScript", "kind": "property", "scope": "Transport", "scopeKind": "interface"}, {"_type": "tag", "name": "reply", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^    const reply: Message = {$/", "language": "TypeScript", "kind": "constant", "scope": "MockTransport.send", "scopeKind": "method"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  send(msg: Message) {$/", "language": "TypeScript", "kind": "method", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  send: (msg: Message) => void;$/", "language": "TypeScript", "kind": "property", "scope": "Transport", "scopeKind": "interface"}, {"_type": "tag", "name": "statusListeners", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const statusListeners: Listener<ConnectionStatus>[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocket", "scopeKind": "function"}, {"_type": "tag", "name": "statusListeners", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private statusListeners: Listener<ConnectionStatus>[] = [];$/", "language": "TypeScript", "kind": "property", "scope": "MockTransport", "scopeKind": "class"}, {"_type": "tag", "name": "transport", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  const transport = connect();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "usernameEchoId", "path": "/home/kavia/workspace/code-generation/real-time-chat-application-221489-221498/chat_frontend/src/lib/ws.ts", "pattern": "/^  private usernameEchoId = 0;$/", "language": "TypeScript", "kind": "property", "scope": "MockTransport", "scopeKind": "class"}], "hash": "0a33e75a0c7527a1e56a858ae61186fd", "format-version": 4, "code-base-name": "chat_frontend", "filename": "chat_frontend/src/lib/ws.ts", "fields": [{"name": "interface Transport {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "close: () => void;", "scope": "Transport", "scopeKind": "interface", "description": "unavailable"}, {"name": "private closed = false;", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "private msgListeners: Listener<Message>[] = [];", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "onMessage: (cb: Listener<Message>) => void;", "scope": "Transport", "scopeKind": "interface", "description": "unavailable"}, {"name": "onStatus: (cb: Listener<ConnectionStatus>) => void;", "scope": "Transport", "scopeKind": "interface", "description": "unavailable"}, {"name": "send: (msg: Message) => void;", "scope": "Transport", "scopeKind": "interface", "description": "unavailable"}, {"name": "private statusListeners: Listener<ConnectionStatus>[] = [];", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}, {"name": "private usernameEchoId = 0;", "scope": "MockTransport", "scopeKind": "class", "description": "unavailable"}]}